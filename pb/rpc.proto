syntax = "proto2";

package pb;

message RPC {
    repeated SubOpts subscriptions = 1;

    message SubOpts {
        optional bool subscribe = 1; // subscribe or unsubcribe
        optional string topicid = 2;
    }

    repeated TopicRpc rpcs = 2;
}

message TopicRpc {
    optional string topicid = 1;

    // Router-specific types
    optional EcRpc ec = 2;
    optional FloodsubRpc floodsub = 3;
}

message EcRpc {
    repeated Chunk chunks = 1;
    repeated string completedMessages = 2; // Message IDs that this peer has completed reconstruction for

    message Chunk {
        optional string messageID = 1;
        optional bytes data = 2;
        optional bytes extra = 3; // encoding extra data (e.g., RlncExtra)
    }
}

message RlncExtra {
    repeated bytes coefficients = 1;
    optional bytes extra = 2; // chunk verifier extra data
}

message RsExtra {
    optional uint32 index = 1;
    optional uint32 chunkCount = 2; // number of data chunks for this message
    optional bytes iwantBitmap = 3; // bitmap of missing chunks (bit i = 1 if chunk i is needed)
    optional bytes extra = 4; // chunk verifier extra data
}

message FloodsubRpc {
    repeated bytes messages = 1;
}
